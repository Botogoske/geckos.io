var geckos;(()=>{"use strict";var e={816:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(28));t.default=o.default},28:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientChannel=void 0;var a=i(n(567)),s=i(n(460)),c=n(651),u=n(856),l=function(){function e(e,t,n,r,o){var i=this;this.userData={},this.receivedReliableMessages=[],this.url=n?e+":"+n:e,this.connectionsManager=new a.default(this.url,t,r,o),this.bridge=this.connectionsManager.bridge,this.bridge.on(c.EVENTS.DISCONNECTED,(function(){return i.bridge.removeAllListeners()}))}return e.prototype.onconnectionstatechange=function(){var e=this,t=this.peerConnection.localPeerConnection;t.onconnectionstatechange=function(){"disconnected"!==t.connectionState&&"closed"!==t.connectionState||e.bridge.emit(c.EVENTS.DISCONNECTED)}},Object.defineProperty(e.prototype,"id",{get:function(){return this.peerConnection.id},enumerable:!1,configurable:!0}),e.prototype.close=function(){this.peerConnection.localPeerConnection.close(),this.bridge.emit(c.EVENTS.DISCONNECTED);try{var e=this.url+"/.wrtc/v2";fetch(e+"/connections/"+this.id+"/close",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(e){console.error(e.message)}},e.prototype.emit=function(e,t,n){var r=this;void 0===t&&(t=null),n&&n.reliable?u.makeReliable(n,(function(n){return r.connectionsManager.emit(e,{MESSAGE:t,RELIABLE:1,ID:n})})):this.connectionsManager.emit(e,t)},Object.defineProperty(e.prototype,"raw",{get:function(){var e=this;return{emit:function(t){return e.emit(c.EVENTS.RAW_MESSAGE,t)}}},enumerable:!1,configurable:!0}),e.prototype.onRaw=function(e){this.bridge.on(c.EVENTS.RAW_MESSAGE,(function(t){!function(t){e(t)}(t)}))},e.prototype.onConnect=function(e){var t;return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return this.peerConnection=new s.default,[4,this.peerConnection.connect(this.connectionsManager)];case 1:return(n=r.sent()).error?e(n.error):(n.userData&&(this.userData=n.userData),this.maxMessageSize=this.connectionsManager.maxMessageSize=null===(t=this.peerConnection.localPeerConnection.sctp)||void 0===t?void 0:t.maxMessageSize,this.onconnectionstatechange(),e()),[2]}}))}))},e.prototype.onDisconnect=function(e){this.bridge.on(c.EVENTS.DISCONNECTED,e)},e.prototype.on=function(e,t){var n=this;this.bridge.on(e,(function(e){var r;e&&1===e.RELIABLE&&"undefined"!==e.ID?(r=(new Date).getTime(),n.receivedReliableMessages.forEach((function(e,t,n){e.expire<=r&&n.splice(t,1)})),0===n.receivedReliableMessages.filter((function(t){return t.id===e.ID})).length&&(n.receivedReliableMessages.push({id:e.ID,timestamp:new Date,expire:(new Date).getTime()+15e3}),t(e.MESSAGE))):t(e)}))},e}();t.ClientChannel=l;t.default=function(e){void 0===e&&(e={});var t=e.authorization,n=void 0===t?void 0:t,r=e.iceServers,o=void 0===r?[]:r,i=e.iceTransportPolicy,a=void 0===i?"all":i,s=e.label,c=void 0===s?"geckos.io":s,u=e.port,f=void 0===u?9208:u,h=e.url,d=void 0===h?location.protocol+"//"+location.hostname:h;return new l(d,n,f,c,{iceServers:o,iceTransportPolicy:a})}},567:function(e,t,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=a(n(997)),c=a(n(208)),u=n(624),l=function(){function e(e,t,n,r){var o=this;this.url=e,this.authorization=t,this.label=n,this.rtcConfiguration=r,this.bridge=new u.Bridge,this.onDataChannel=function(e){var t=e.channel;t.label===o.label&&(o.dataChannel=t,o.dataChannel.binaryType="arraybuffer",o.dataChannel.onmessage=function(e){var t=s.default(e),n=t.key,r=t.data;o.bridge.emit(n,r)})}}return e.prototype.emit=function(e,t){void 0===t&&(t=null),c.default(this.dataChannel,this.maxMessageSize,e,t)},e.prototype.fetchAdditionalCandidates=function(e,t){return o(this,void 0,void 0,(function(){var n,r=this;return i(this,(function(o){switch(o.label){case 0:return[4,fetch(e+"/connections/"+t+"/additional-candidates",{method:"GET",headers:{"Content-Type":"application/json"}})];case 1:return(n=o.sent()).ok?[4,n.json()]:[3,3];case 2:o.sent().forEach((function(e){r.localPeerConnection.addIceCandidate(e)})),o.label=3;case 3:return[2]}}))}))},e.prototype.connect=function(){return o(this,void 0,void 0,(function(){var e,t,n,o,a,s,c,u,l,f,h,d,p,v,y,E,g=this;return i(this,(function(i){switch(i.label){case 0:e=this.url+"/.wrtc/v2",t={"Content-Type":"application/json"},this.authorization&&(t=r(r({},t),((E={}).Authorization=this.authorization,E))),n={},i.label=1;case 1:return i.trys.push([1,4,,5]),[4,fetch(e+"/connections",{method:"POST",headers:t})];case 2:return[4,i.sent().json()];case 3:return o=i.sent(),n=o.userData,this.remotePeerConnection=o,[3,5];case 4:return a=i.sent(),console.error(a.message),[2,{error:a}];case 5:s=this.remotePeerConnection,c=s.id,u=s.localDescription,l=r({sdpSemantics:"unified-plan"},this.rtcConfiguration),f=RTCPeerConnection||webkitRTCPeerConnection||mozRTCPeerConnection,this.localPeerConnection=new f(l),function(e,t,n,r){return void 0===e&&(e=10),void 0===t&&(t=50),void 0===n&&(n=1.8),void 0===r&&(r=20),Array(e).fill(0).map((function(e,o){return parseInt((t*Math.pow(n,o)).toString())+parseInt((Math.random()*r).toString())}))}().forEach((function(t){setTimeout((function(){g.fetchAdditionalCandidates(e,c)}),t)})),i.label=6;case 6:return i.trys.push([6,16,,17]),[4,this.localPeerConnection.setRemoteDescription(u)];case 7:return i.sent(),this.localPeerConnection.addEventListener("datachannel",this.onDataChannel,{once:!0}),[4,this.localPeerConnection.createAnswer()];case 8:return h=i.sent(),d=new RTCSessionDescription({type:"answer",sdp:h.sdp}),[4,this.localPeerConnection.setLocalDescription(d)];case 9:i.sent(),i.label=10;case 10:return i.trys.push([10,12,,13]),[4,fetch(e+"/connections/"+c+"/remote-description",{method:"POST",body:JSON.stringify(this.localPeerConnection.localDescription),headers:{"Content-Type":"application/json"}})];case 11:return i.sent(),[3,13];case 12:return p=i.sent(),console.error(p.message),[2,{error:p}];case 13:return v=function(){return new Promise((function(e){g.localPeerConnection.addEventListener("datachannel",(function(){e()}),{once:!0})}))},this.dataChannel?[3,15]:[4,v()];case 14:i.sent(),i.label=15;case 15:return[2,{userData:n,localPeerConnection:this.localPeerConnection,dataChannel:this.dataChannel,id:c}];case 16:return y=i.sent(),console.error(y.message),this.localPeerConnection.close(),[2,{error:y}];case 17:return[2]}}))}))},e}();t.default=l},460:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(651),a=function(){function e(){}return e.prototype.connect=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,s,c;return o(this,(function(o){switch(o.label){case 0:return RTCPeerConnection||webkitRTCPeerConnection||mozRTCPeerConnection?[4,e.connect()]:[3,2];case 1:return t=o.sent(),n=t.localPeerConnection,r=t.dataChannel,a=t.id,s=t.userData,(c=t.error)?[2,{error:c}]:n&&r&&a&&s?(this.localPeerConnection=n,this.dataChannel=r,this.id=a,[2,{userData:s}]):[2,{error:new Error('Something went wrong in "await connectionsManager.connect()"')}];case 2:return c=new Error(i.ERRORS.BROWSER_NOT_SUPPORTED),console.error(c.message),[2,{error:c}]}}))}))},e}();t.default=a},624:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Bridge=void 0;var r=n(197),o=function(){function e(){this.eventEmitter=new r.Events}return e.prototype.emit=function(e,t,n){void 0===n&&(n={}),this.eventEmitter.emit(e,t,n)},e.prototype.on=function(e,t){return this.eventEmitter.on(e,(function(e,n){t(e,n)}))},e.prototype.removeAllListeners=function(){this.eventEmitter.removeAllListeners()},e}();t.Bridge=o;var i=new o;t.default=i},651:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ERRORS=t.EVENTS=void 0;t.EVENTS={CONNECT:"connect",CONNECTION:"connection",DATA_CHANNEL_IS_OPEN:"dataChannelIsOpen",DISCONNECT:"disconnect",DISCONNECTED:"disconnected",DROP:"dropped",ERROR:"error",RAW_MESSAGE:"rawMessage",RECEIVED_FROM_DATA_CHANNEL:"receiveFromDataChannel",SEND_OVER_DATA_CHANNEL:"sendOverDataChannel"};t.ERRORS={BROWSER_NOT_SUPPORTED:"BROWSER_NOT_SUPPORTED",COULD_NOT_PARSE_MESSAGE:"COULD_NOT_PARSE_MESSAGE",DROPPED_FROM_BUFFERING:"DROPPED_FROM_BUFFERING",MAX_MESSAGE_SIZE_EXCEEDED:"MAX_MESSAGE_SIZE_EXCEEDED"}},142:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isJSONMessage=t.isObject=t.isBufferMessage=t.isStringMessage=void 0;var r=n(487);t.isStringMessage=function(e){return"string"==typeof e};t.isBufferMessage=function(e){return e instanceof ArrayBuffer||e instanceof r.ArrayBufferView};t.isObject=function(e){return"object"==typeof e};t.isJSONMessage=function(e){try{return"string"==typeof e&&(!!isNaN(parseInt(e))&&(JSON.parse(e),!0))}catch(e){return!1}}},155:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){void 0===e&&(e=24);for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<e;r++)n+=t.charAt(Math.floor(Math.random()*t.length));return n}},997:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=n(651),o=n(142);t.default=function(e){var t=e.data;t||(t=e);var n=o.isBufferMessage(t),i=o.isJSONMessage(t),a=o.isStringMessage(t);if(i){var s=JSON.parse(t),c=Object.keys(s)[0];return{key:c,data:s[c]}}return n||a?{key:r.EVENTS.RAW_MESSAGE,data:t}:{key:"error",data:new Error(r.ERRORS.COULD_NOT_PARSE_MESSAGE)}}},856:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeReliable=void 0;var o=r(n(155)),i=r(n(356));t.makeReliable=function(e,t){var n=e.interval,r=void 0===n?150:n,a=e.runs,s=void 0===a?10:a,c=o.default(24);i.default(r,s,(function(){t(c)}))}},356:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t,n){void 0===e&&(e=200),void 0===t&&(t=1);var r=0;if("function"==typeof n){var o=setInterval((function(){n(),++r===t-1&&clearInterval(o)}),e);n()}else console.error("You have to define your callback function!")}},208:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=n(651),o=n(142);t.default=function(e,t,n,i){var a,s;void 0===i&&(i=null);var c=function(n,r){var o,i=null!==(o=n.byteLength)&&void 0!==o?o:2*n.length;if("number"==typeof t&&i>t)throw new Error("maxMessageSize of "+t+" exceeded");Promise.resolve().then((function(){e.send?e.send(n):r?e.sendMessageBinary(Buffer.from(n)):e.sendMessage(n)})).catch((function(e){console.log("error",e)}))};if(e&&("open"===e.readyState||(null===(s=e.isOpen)||void 0===s?void 0:s.call(e))))try{n===r.EVENTS.RAW_MESSAGE&&null!==i&&(o.isStringMessage(i)||o.isBufferMessage(i))?c(i,o.isBufferMessage(i)):c(JSON.stringify(((a={})[n]=i,a)),!1)}catch(e){return console.error("Error in sendMessage.ts: ",e.message),e}}},487:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ArrayBufferView=void 0;var n=Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array)).constructor;t.ArrayBufferView=n},197:function(e,t,n){var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Events=void 0;var o=n(789),i=function(e,t,n){void 0===n&&(n=!1),this.fn=e,this.context=t,this.once=n},a=function(e,t,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,r||e,o);return e._events.has(t)?e._events.get(t).fn?e._events.set(t,[e._events.get(t),a]):e._events.get(t).push(a):(e._events.set(t,a),e._eventsCount++),e},s=function(e,t){0==--e._eventsCount?e._events=new Map:e._events.delete(t)},c=function(){function e(){this._events=new Map,this._eventsCount=0}return Object.defineProperty(e,"VERSION",{get:function(){return o.VERSION},enumerable:!1,configurable:!0}),e.prototype.eventNames=function(){return Array.from(this._events.keys())},e.prototype.listeners=function(e){var t=this._events.get(e);if(!t)return[];if(t.fn)return[t.fn];for(var n=0,r=t.length,o=new Array(r);n<r;n++)o[n]=t[n].fn;return o},e.prototype.listenerCount=function(e){var t=this._events.get(e);return t?t.fn?1:t.length:0},e.prototype.emit=function(e){for(var t,n,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];if(!this._events.has(e))return!1;var a,s=this._events.get(e);if(s.fn)return s.once&&this.removeListener(e,s.fn,void 0,!0),(t=s.fn).call.apply(t,r([s.context],o)),!0;var c=s.length;for(a=0;a<c;a++)s[a].once&&this.removeListener(e,s[a].fn,void 0,!0),(n=s[a].fn).call.apply(n,r([s[a].context],o));return!0},e.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},e.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},e.prototype.removeListener=function(e,t,n,r){if(!this._events.has(e))return this;if(!t)return s(this,e),this;var o=this._events.get(e);if(o.fn)o.fn!==t||r&&!o.once||n&&o.context!==n||s(this,e);else{for(var i=0,a=[],c=o.length;i<c;i++)(o[i].fn!==t||r&&!o[i].once||n&&o[i].context!==n)&&a.push(o[i]);a.length?this._events.set(e,1===a.length?a[0]:a):s(this,e)}return this},e.prototype.removeAllListeners=function(e){return e?this._events.delete(e)&&s(this,e):(this._events=new Map,this._eventsCount=0),this},Object.defineProperty(e.prototype,"off",{get:function(){return this.removeListener},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"addListener",{get:function(){return this.on},enumerable:!1,configurable:!0}),e}();t.Events=c},789:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="0.0.5"}},t={};var n=function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}(816);geckos=n.default})();